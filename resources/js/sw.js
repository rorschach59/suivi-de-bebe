// importScripts("https://cdn.pushalert.co/sw-59962_2.js");
var comm_url = "https://request.pushalert.co/";
var default_title = "";
var default_message = "";
var default_icon = "https://cdn.pushalert.co/icons/default_icon-58757_2.png";
var default_url = "https://bebe.remipouly.fr";
var last_updated = "1691671381";
var client_id = 58757;
var domain_id = 2;
var pa_subdomain = "https://bebe648.pushalert.co";
var appPublicKey = 'BB1/Viwww5ObwaoGfU3815ubgGl7aWz+5ly8MVukLytzsx1hTKPXcmxBZ+1+CyNNr6G/ZgGxIGo8wG3J7j5mio0=';


var last_url_id=-1,endpoint="",endpoint_full="";if(void 0===domain_id)var domain_id=1;function getBrowserInfo(){return!function(i,e){this[i]=e()}("browser_info",function(){function i(i){function o(e){var o=i.match(e);return o&&o.length>1&&o[1]||""}var n,t,r=o(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(i)&&/android/i.test(i),s=/CrOS/.test(i),d=/silk/i.test(i),c=/sailfish/i.test(i),l=/tizen/i.test(i),f=/(web|hpw)os/i.test(i),u=/windows phone/i.test(i),m=!u&&/windows/i.test(i),p=!r&&!d&&/macintosh/i.test(i),w=!a&&!c&&!l&&!f&&/linux/i.test(i),b=o(/edge\/(\d+(\.\d+)?)/i),h=o(/version\/(\d+(\.\d+)?)/i),v=/tablet/i.test(i)||/android/i.test(i)&&!/mobile/i.test(i),g=!v&&/[^-]mobi/i.test(i);/opera mini/i.test(i)?(n={name:"Opera Mini",operamini:e,majorVersion:o(/(?:opera mini)[\s\/](\d+(\.\d+)?)/i)||h,version:o(/(?:opera mini)\/([\d\.]+)/i)},g=e,v=!1):/opera|opr/i.test(i)?n={name:"Opera",opera:e,majorVersion:h||o(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i),version:o(/(?:opera|opr)\/([\d\.]+)/i)}:/ucbrowser/i.test(i)?n={name:"UC Browser",ucbrowser:e,majorVersion:o(/(?:ucbrowser)[\s\/](\d+(\.\d+)?)/i)||h,version:o(/(?:ucbrowser)\/([\d\.]+)/i)}:/acheetahi/i.test(i)?n={name:"CM Browser",cmbrowser:e,majorVersion:o(/(?:acheetahi)[\s\/](\d+(\.\d+)?)/i)||h,version:o(/(?:acheetahi)\/([\d\.]+)/i)}:/yabrowser/i.test(i)?n={name:"Yandex Browser",yandexbrowser:e,version:h||o(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:u?(n={name:"Windows Phone",windowsphone:e},b?(n.msedge=e,n.version=b):(n.msie=e,n.version=o(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(i)?n={name:"Internet Explorer",msie:e,version:o(/(?:msie |rv:)([\.\d]+)/i),majorVersion:o(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:s?n={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:o(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(i)?n={name:"Microsoft Edge",msedge:e,version:b,majorVersion:o(/(?:edge)\/(\d+(\.\d+)?)/i)}:/chrome.+? edgA/i.test(i)?n={name:"Microsoft Edge",msedgeA:e,majorVersion:o(/(?:edgA)\/(\d+(\.\d+)?)/i),version:o(/(?:edgA)\/([\d\.]+)/i)||b}:/chrome.+? edg/i.test(i)||/edgios/i.test(i)?n={name:"Microsoft Edge",msedgeA:e,version:o(/(?:edgios|edg)\/([\d\.]+)/i),majorVersion:o(/(?:edgios|edg)\/(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(i)?n={name:"Chrome",chrome:e,version:o(/(?:chrome|crios|crmo)\/([\d\.]+)/i),majorVersion:o(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:c?n={name:"Sailfish",sailfish:e,version:o(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(i)?n={name:"SeaMonkey",seamonkey:e,version:o(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(i)?(n={name:"Firefox",firefox:e,version:o(/(?:firefox|iceweasel|fxios)[ \/]([\d\.]+)/i),majorVersion:o(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(i)&&(n.firefoxos=e)):d?n={name:"Amazon Silk",silk:e,version:o(/silk\/(\d+(\.\d+)?)/i)}:a?n={name:"Android",version:h}:/phantom/i.test(i)?n={name:"PhantomJS",phantom:e,version:o(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(i)||/rim\stablet/i.test(i)?n={name:"BlackBerry",blackberry:e,version:h||o(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(n={name:"WebOS",webos:e,version:h||o(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(i)&&(n.touchpad=e)):n=/bada/i.test(i)?{name:"Bada",bada:e,version:o(/dolfin\/(\d+(\.\d+)?)/i)}:l?{name:"Tizen",tizen:e,version:o(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||h}:/safari/i.test(i)?{name:"Safari",safari:e,version:o(/(?:version)\/([\d\.]+)/i),majorVersion:o(/(?:version)\/(\d+(\.\d+)?)/i)||h}:{name:o(/^(.*)\/(.*) /),version:(t=i.match(/^(.*)\/(.*) /))&&t.length>1&&t[2]||""},!n.msedge&&/(apple)?webkit/i.test(i)?(n.name=n.name||"Webkit",n.webkit=e,!n.version&&h&&(n.version=h)):!n.opera&&/gecko\//i.test(i)&&(n.name=n.name||"Gecko",n.gecko=e,n.version=n.version||o(/gecko\/(\d+(\.\d+)?)/i)),!n.msedge&&(a||n.silk)?n.android=e:r?(n[r]=e,n.ios=e):m?n.windows=e:p?n.mac=e:w&&(n.linux=e);var k="";n.windowsphone?k=o(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r?k=(k=o(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?k=o(/android[ \/-](\d+(\.\d+)*)/i):n.webos?k=o(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?k=o(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?k=o(/bada\/(\d+(\.\d+)*)/i):n.tizen?k=o(/tizen[\/\s](\d+(\.\d+)*)/i):n.windows?k=o(/windows nt[\/\s](\d+(\.\d+)*)/i):n.mac&&(k=o(/mac os x[\/\s](\d+(_\d+)*)/i)),k&&(n.osversion=k);var y=k.split(".")[0];return v||"ipad"==r||a&&(3==y||4==y&&!g)||n.silk?n.tablet=e:(g||"iphone"==r||"ipod"==r||a||n.blackberry||n.webos||n.bada)&&(n.mobile=e),n.msedge||n.msie&&n.version>=10||n.yandexbrowser&&n.version>=15||n.chrome&&n.version>=20||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1?n.a=e:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6?n.c=e:n.x=e,n}var e=!0,o=i("undefined"!=typeof navigator?navigator.userAgent:"");o.test=function(i){for(var e=0;e<i.length;++e){var n=i[e];if("string"==typeof n&&n in o)return!0}return!1},o._detect=i;var n={};return o.mobile?n.type="mobile":o.tablet?n.type="tablet":n.type="desktop",o.android?n.os="android":o.ios?n.os="ios":o.windows?n.os="windows":o.mac?n.os="mac":o.linux?n.os="linux":o.windowsphone?n.os="windowsphone":o.webos?n.os="webos":o.blackberry?n.os="blackberry":o.bada?n.os="bada":o.tizen?n.os="tizen":o.sailfish?n.os="sailfish":o.firefoxos?n.os="firefoxos":o.chromeos?n.os="chromeos":n.os="unknown",o.osversion&&(n.osVer=o.osversion),o.chrome?n.browser="chrome":o.firefox?n.browser="firefox":o.opera?n.browser="opera":o.operamini?n.browser="operamini":o.ucbrowser?n.browser="ucbrowser":o.cmbrowser?n.browser="cmbrowser":o.safari||o.iosdevice&&("ipad"==o.iosdevice||"ipod"==o.iosdevice||"iphone"==o.iosdevice)?n.browser="safari":o.msie?n.browser="ie":o.yandexbrowser?n.browser="yandexbrowser":o.msedgeA?n.browser="edge":o.msedge?n.browser="edge":o.seamonkey?n.browser="seamonkey":o.blackberry?n.browser="blackberry":o.touchpad?n.browser="touchpad":o.silk?n.browser="silk":n.browser="unknown",o.version&&(n.browserVer=o.version),o.majorVersion&&(n.browserMajor=o.majorVersion),n.language=navigator.language||"",n.engine=navigator.product||"",n.userAgent=navigator.userAgent,n}),browser_info}self.addEventListener("install",function(i){self.skipWaiting()}),self.addEventListener("push",function(i){if(i.data){var e,o,n=JSON.parse(i.data.text()),t=getBrowserInfo(),r="firefox"==t.browser;e=n.title;var a=n.message,s=n.icon,d=n.url,c=n.uid,l=n.eid,f=0;n.hasOwnProperty("sid")&&(f=n.sid);var u=n.type,m=n.url_id,p=n.tag,w=!0;if(r)n.hasOwnProperty("requireInteraction")&&!1===n.requireInteraction&&(w=!1),o={body:a,icon:s,tag:p,requireInteraction:w,data:{url:d,url_id:m,uid:c,eid:l,type:u,sid:f}};else{var b=n.badge_icon,h="";"mac"===t.os&&("chrome"===t.browser||"opera"===t.browser)?w=!1:n.hasOwnProperty("requireInteraction")&&!1===n.requireInteraction&&(w=!1);var v=[],g=[];g.url=d,g.url_id=m,g.uid=c,g.eid=l,g.sid=f,g.type=u,void 0!==n.action1&&(v[0]={action:"action1",title:n.action1.title},g.action1=n.action1.url),void 0!==n.action2&&(v[1]={action:"action2",title:n.action2.title},g.action2=n.action2.url),void 0!==n.image&&(h=n.image),o={body:a,icon:s,image:h,badge:b,tag:p,requireInteraction:w,data:g,actions:v}}var k=[];for(key in t)k.push(key+"="+encodeURIComponent(t[key]));k=k.join("&"),fetch(comm_url+"delivered.php?url_id="+m+"&nref_id="+n.nref_id+"&uid="+c+"&"+k+"&client_id="+client_id+"&domain_id="+domain_id+"&sid="+f+"&eid="+l+"&type="+u).then(function(i){200!==i.status&&console.log("Looks like there was a problem. Status Code D: "+i.status)}).catch(function(i){}),i.waitUntil(self.registration.showNotification(e,o))}else i.waitUntil(self.registration.pushManager.getSubscription().then(function(i){return endpoint=i.endpoint.slice(i.endpoint.lastIndexOf("/")+1),endpoint_full=i.endpoint,fetch(comm_url+"getNotification.php?t="+new Date().getTime()+"&endpoint="+encodeURIComponent(endpoint)+"&endpoint_full="+encodeURIComponent(endpoint_full)+"&client_id="+client_id+"&domain_id="+domain_id).then(function(i){if(200!==i.status)throw console.log("Looks like there was a problem. Status Code G: "+i.status),Error("Looks like there was a problem. Status Code: "+i.status);return i.json().then(function(i){var e=/firefox/i.test(navigator.userAgent),o=0;if(e&&(o=Math.floor(1e3*Math.random()+1)),e)setTimeout(function(){if(i.error||!i.notification)throw Error("Data not received: "+JSON.stringify(i));var e=i.notification.title,o=i.notification.message,n=i.notification.icon,t=i.notification.url,r=i.notification.uid,a=i.notification.eid,s=i.notification.type,d=i.notification.url_id,c=i.notification.tag,l=!0;return i.notification.hasOwnProperty("requireInteraction")&&!1===i.notification.requireInteraction&&(l=!1),self.registration.showNotification(e,{body:o,icon:n,tag:c,requireInteraction:l,data:{url:t,url_id:d,uid:r,eid:a,type:s}})},o);else{if(i.error||!i.notification)throw Error("Data not received: "+JSON.stringify(i));var n=i.notification.title,t=i.notification.message,r=i.notification.icon,a=i.notification.badge_icon,s=i.notification.url,d=i.notification.uid,c=i.notification.eid,l=i.notification.type,f=i.notification.url_id,u="",m=i.notification.tag,p=!0;i.notification.hasOwnProperty("requireInteraction")&&!1===i.notification.requireInteraction&&(p=!1);var w=[],b=[];return b.url=s,b.url_id=f,b.uid=d,b.eid=c,b.type=l,void 0!==i.notification.action1&&(w[0]={action:"action1",title:i.notification.action1.title},b.action1=i.notification.action1.url),void 0!==i.notification.action2&&(w[1]={action:"action2",title:i.notification.action2.title},b.action2=i.notification.action2.url),void 0!==i.notification.image&&(u=i.notification.image),self.registration.showNotification(n,{body:t,icon:r,image:u,badge:a,tag:m,requireInteraction:p,data:b,actions:w})}})}).catch(function(i){fetch(comm_url+"error.php?txt="+encodeURIComponent(i.toString())+"&endpoint="+encodeURIComponent(endpoint)+"&endpoint_full="+encodeURIComponent(endpoint_full)+"&client_id="+client_id+"&domain_id="+domain_id)})}).catch(function(i){fetch(comm_url+"error.php?txt="+encodeURIComponent(i.toString())+"&endpoint="+encodeURIComponent(endpoint)+"&endpoint_full="+encodeURIComponent(endpoint_full)+"&client_id="+client_id+"&domain_id="+domain_id)}))}),self.addEventListener("pushsubscriptionchange",function(i){var e=i.oldSubscription?i.oldSubscription:null,o=i.newSubscription?i.newSubscription:null;if(null!=e&&null!=o){var n,t,r=getBrowserInfo().browser,a=e.endpoint.lastIndexOf("/");n="edge"===r?new URL(e.endpoint).searchParams.get("token"):e.endpoint.slice(a+1),a=o.endpoint.lastIndexOf("/"),t="edge"===r?new URL(o.endpoint).searchParams.get("token"):o.endpoint.slice(a+1),i.waitUntil(fetch(comm_url+"pushsubscriptionchange?client_id="+client_id+"&domain_id="+domain_id+"&old_endpoint_url="+encodeURIComponent(n)+"&new_endpoint_url="+encodeURIComponent(t)+"&new_endpoint="+encodeURIComponent(JSON.stringify(o))).then(function(i){i.status}).catch(function(i){}))}else null!=e&&i.waitUntil(registration.pushManager.subscribe(i.oldSubscription.options).then(i=>{var o,n,t=getBrowserInfo().browser,r=e.endpoint.lastIndexOf("/");o="edge"===t?new URL(e.endpoint).searchParams.get("token"):e.endpoint.slice(r+1),r=i.endpoint.lastIndexOf("/"),n="edge"===t?new URL(i.endpoint).searchParams.get("token"):i.endpoint.slice(r+1),fetch(comm_url+"pushsubscriptionchange?client_id="+client_id+"&domain_id="+domain_id+"&old_endpoint_url="+encodeURIComponent(o)+"&new_endpoint_url="+encodeURIComponent(n)+"&new_endpoint="+encodeURIComponent(JSON.stringify(i))).then(function(i){i.status}).catch(function(i){})}))}),self.addEventListener("notificationclick",function(i){var e=i.notification.data.url_id,o=i.notification.data.uid,n=i.notification.data.eid,t=i.notification.data.sid,r=i.notification.data.type;last_url_id=e,i.notification.close();var a=i.notification.data.url,s=0;if("action1"===i.action?(a=i.notification.data.action1,s=1):"action2"===i.action&&(a=i.notification.data.action2,s=2),0==o);else{var d=[],c=getBrowserInfo();for(key in c)d.push(key+"="+encodeURIComponent(c[key]));fetch(comm_url+"trackClicked.php?url_id="+e+"&uid="+o+"&"+(d=d.join("&"))+"&client_id="+client_id+"&domain_id="+domain_id+"&clicked_on="+s+"&sid="+t+"&eid="+n+"&type="+r).then(function(i){200!==i.status&&console.log("Looks like there was a problem. Status Code: "+i.status)}).catch(function(i){})}i.waitUntil(clients.matchAll({type:"window"}).then(function(i){for(var e=0;e<i.length;e++){var o=i[e];if(o.url===a&&"focus"in o)return o.focus()}if(clients.openWindow)return clients.openWindow(a)}))});
self.addEventListener('activate',function(a){a.waitUntil(clients.claim())});const WorkerMessengerCommand={AMP_SUBSCRIPION_STATE:'amp-web-push-subscription-state',AMP_SUBSCRIBE:'amp-web-push-subscribe',AMP_UNSUBSCRIBE:'amp-web-push-unsubscribe'};self.addEventListener('message',a=>{const{command:b}=a.data;b===WorkerMessengerCommand.AMP_SUBSCRIPION_STATE?onMessageReceivedSubscriptionState():b===WorkerMessengerCommand.AMP_SUBSCRIBE?onMessageReceivedSubscribe():b===WorkerMessengerCommand.AMP_UNSUBSCRIBE?onMessageReceivedUnsubscribe():void 0});function onMessageReceivedSubscriptionState(){let a=null;self.registration.pushManager.getSubscription().then(b=>{return a=b,b?self.registration.pushManager.permissionState(b.options):null}).then(b=>{if(null==b)broadcastReply(WorkerMessengerCommand.AMP_SUBSCRIPION_STATE,!1);else{const c=!!a&&'granted'===b;broadcastReply(WorkerMessengerCommand.AMP_SUBSCRIPION_STATE,c)}})}function onMessageReceivedSubscribe(){self.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:urlBase64ToUint8Array(appPublicKey)}).then(function(a){broadcastReply(WorkerMessengerCommand.AMP_SUBSCRIBE,null),sendSub(a)})}function onMessageReceivedUnsubscribe(){self.registration.pushManager.getSubscription().then(function(a){a&&a.unsubscribe().then(function(){broadcastReply(WorkerMessengerCommand.AMP_UNSUBSCRIBE,null),unsubscribe(a)})})}function broadcastReply(a,b){self.clients.matchAll().then(c=>{for(let d=0;d<c.length;d++){const f=c[d];f.postMessage({command:a,payload:b})}})}function urlBase64ToUint8Array(a){const b='='.repeat((4-a.length%4)%4),c=(a+b).replace(/\-/g,'+').replace(/_/g,'/'),d=self.atob(c),f=new Uint8Array(d.length);for(let g=0;g<d.length;++g)f[g]=d.charCodeAt(g);return f}function sendSub(a){var b=[],c=getBrowserInfo(),d=c.browser;for(key in c)b.push(key+'='+encodeURIComponent(c[key]));b=b.join('&'),b=b+'&pa_id='+client_id+'&domain_id='+domain_id,last_indexof_slash=a.endpoint.lastIndexOf('/'),b=b+'&endpoint_url='+encodeURIComponent(a.endpoint.substr(0,last_indexof_slash)),b=b+'&subs_info='+encodeURIComponent(JSON.stringify(a));var f;if('edge'===d){var g=new URL(a.endpoint);f=g.searchParams.get('token')}else f=a.endpoint.slice(last_indexof_slash+1);b=b+'&endpoint='+encodeURIComponent(f),b+='&amp=1',fetch(pa_subdomain+'/subscribe/'+f,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded; charset=UTF-8'},body:b}).then(function(h){h.json().then(function(j){if(j.welcome_enable){var k=!0;j.hasOwnProperty('welcome_req_interaction')&&!1===j.welcome_req_interaction&&(k=!1);var l=[],m=[];m.url=j.welcome_url,m.url_id=0,m.uid=0,'undefined'!=typeof j.action1_title&&(l[0]={action:'action1',title:j.action1_title},m.action1=j.action1_url),'undefined'!=typeof j.action2_title&&(l[1]={action:'action2',title:j.action2_title},m.action2=j.action2_url),self.registration.showNotification(j.welcome_title,{body:j.welcome_msg,icon:j.welcome_icon,requireInteraction:k,data:m,actions:l})}}).catch(function(j){console.log('Error sending subscription to server:'+j.toString())})})}function unsubscribe(a){var b=getBrowserInfo(),c=b.browser,d;if('edge'===c){var f=new URL(a.endpoint);d=f.searchParams.get('token')}else d=a.endpoint.slice(a.endpoint.lastIndexOf('/')+1);fetch(pa_subdomain+'/unsubscribe/'+d,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded; charset=UTF-8'},body:'pa_id='+client_id+'&domain_id='+domain_id+'&endpoint='+encodeURIComponent(d)}).then(function(g){g.json().then(function(){}).catch(function(h){console.error('Error sending subscription to server:',h)})})}
